<!-- Upload UI -->
<div *ngIf="!pdfSrc && !loading" class="d-flex justify-content-center align-items-center" style="height: 88vh;">
  <div class="upload-box text-center p-4 rounded shadow-sm"
       (drop)="handleDrop($event)"
       (dragover)="handleDragOver($event)">
    <i class="bi bi-upload fs-1 text-purple mb-3"></i>
    <h5>Upload PDF to start chatting</h5>
    <p class="text-muted">Click or drag and drop your file here</p>
    <input type="file" class="d-none" #fileInput (change)="uploadPdf($event)" accept="application/pdf" />
    <button class="btn btn-outline-purple mt-2" (click)="fileInput.click()">Choose PDF</button>
  </div>
</div>

<!-- Loading Spinner -->
<div *ngIf="loading" class="d-flex flex-column align-items-center justify-content-center" style="height: 100vh;">
  <div class="spinner-border text-purple" role="status"></div>
  <p class="mt-3 fw-bold text-purple">Uploading PDF</p>
  <div class="progress w-50 mt-2">
    <div class="progress-bar progress-bar-striped bg-purple" style="width: 100%"></div>
  </div>
</div>

<!-- Post-Upload Split UI -->
<div *ngIf="pdfSrc && !loading" class="row m-0 g-0" style="height: calc(100vh - 56px); overflow: hidden;">
  <!-- Left: Chat Panel -->
  <div class="col-md-5 p-4 d-flex flex-column justify-content-between" style="overflow-y: auto;">
    <div class="overflow-auto" style="flex: 1 1 auto; max-height: calc(100vh - 200px);">
      <h4 class="text-purple">Your document is ready</h4>
      <p class="text-muted">You can now ask questions about the content.</p>

      <div *ngFor="let msg of messages" class="mb-3">
        <strong>{{ msg.sender === 'user' ? 'You' : 'Bot' }}:</strong> {{ msg.text }}
      </div>
    </div>

    <div class="input-group mt-3">
      <input
        [(ngModel)]="userMessage"
        class="form-control"
        placeholder="Ask about the document"
        (keyup.enter)="sendMessage()" />
      <button class="btn btn-send" (click)="sendMessage()" type="button">
        <i class="bi bi-send"></i>
      </button>
    </div>
  </div>

  <!-- Right: PDF Viewer -->
  <div class="col-md-7 p-4 bg-light d-flex flex-column" style="height: 100%;">
    <pdf-viewer [src]="pdfSrc" [page]="page" [show-all]="false" style="flex: 1 1 auto;"></pdf-viewer>
    <div class="d-flex justify-content-between mt-2">
      <button class="btn btn-outline-purple" (click)="prevPage()">Previous</button>
      <span class="text-muted">Page {{ page }} of {{ totalPages }}</span>
      <button class="btn btn-outline-purple" (click)="nextPage()" [disabled]="page >= totalPages">Next</button>
    </div>
  </div>
</div>
